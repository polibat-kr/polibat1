<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <meta content="polibat 회원가입 페이지" name="description"/>
    <meta content="회원가입, 정치인, 일반회원, polibat" name="keywords"/>
    <title>회원가입 (일반회원 / 정치인)</title>
    
    <!-- 웹폰트 -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,400" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic" rel="stylesheet"/>
    
    <!-- 스타일시트 -->
    <link href="css/animate.css" rel="stylesheet"/>
    <link href="css/icomoon.css" rel="stylesheet"/>
    <link href="css/bootstrap.css" rel="stylesheet"/>
    <link href="css/magnific-popup.css" rel="stylesheet"/>
    <link href="css/owl.carousel.min.css" rel="stylesheet"/>
    <link href="css/owl.theme.default.min.css" rel="stylesheet"/>
    <link href="css/flexslider.css" rel="stylesheet"/>
    <link href="css/pricing.css" rel="stylesheet"/>
    <link href="css/style.css" rel="stylesheet"/>
    
    <!-- Modernizr JS -->
    <script src="js/modernizr-2.6.2.min.js"></script>
    
    <!-- 커스텀 스타일 -->
    <style>
        #wrap {
            padding: 80px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .signup-container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        
        h2 {
            text-align: center;
            margin-bottom: 24px;
            color: #333;
        }
        
        /* 폼 요소 스타일 */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: flex;
            align-items: center;
            font-size: 14px;
            gap: 6px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="password"],
        .form-group input[type="tel"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.2);
        }
        
        .form-group input.error {
            border-color: #ff0000;
            background-color: #ffeaea;
        }
        
        /* 입력 필드와 버튼 조합 */
        .input-with-button {
            display: flex;
            gap: 8px;
        }
        
        .input-with-button input {
            flex: 1;
        }
        
        /* 버튼 스타일 */
        .check-btn {
            padding: 10px 14px;
            font-size: 13px;
            background: #000;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease;
            white-space: nowrap;
        }
        
        .check-btn:hover:not(:disabled) {
            background-color: #333;
        }
        
        .check-btn:disabled {
            background-color: #999;
            cursor: not-allowed;
        }
        
        /* 메시지 스타일 */
        .error-msg, .info-msg {
            font-size: 13px;
            margin-top: 8px;
            display: none;
        }
        
        .error-msg { color: #ff0000; }
        .info-msg { color: #008000; }
        
        .strength-msg {
            margin-top: 6px;
            font-size: 13px;
            font-weight: bold;
        }
        
        .weak { color: #ff0000; }
        .medium { color: #ff8c00; }
        .strong { color: #008000; }
        
        /* 가입 버튼 */
        .signup-button {
            background-color: #000;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            width: 100%;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 20px;
        }
        
        .signup-button:hover:not(:disabled) {
            background-color: #333;
        }
        
        .signup-button:disabled {
            background-color: #999;
            cursor: not-allowed;
        }
        
        /* 성공 메시지 */
        .success-msg {
            color: #008000;
            text-align: center;
            font-size: 15px;
            margin-top: 20px;
            display: none;
            font-weight: bold;
        }
        
        /* 약관 동의 스타일 */
        .agreement-section {
            margin: 20px 0;
            padding: 16px;
            background-color: #f8f8f8;
            border-radius: 8px;
        }
        
        .agreement-label {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .agreement-label input[type="checkbox"] {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            vertical-align: middle;
        }
        
        .agreement-label span {
            display: inline-block;
            vertical-align: middle;
            line-height: 16px;
        }
        
        /* 셀렉트 박스 */
        .select-box {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 14px;
            background-color: #fff;
            cursor: pointer;
            box-sizing: border-box;
        }
        
        /* 탭 스타일 */
        .tab-container {
            display: flex;
            margin-bottom: 24px;
            overflow: hidden;
            border-radius: 8px;
        }
        
        .tab-button {
            flex: 1;
            padding: 12px;
            font-weight: bold;
            font-size: 15px;
            cursor: pointer;
            border: none;
            background-color: #f8f8f8;
            color: #555;
            transition: all 0.3s ease;
        }
        
        .tab-button:not(:last-child) {
            border-right: 1px solid #ddd;
        }
        
        .tab-button.active {
            background-color: #000;
            color: #fff;
        }
        
        .tab-button:hover:not(.active) {
            background-color: #eee;
        }
        
        /* 설명 텍스트 */
        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            line-height: 1.4;
        }
        
        /* 닉네임 생성 버튼 */
        .generate-btn {
            padding: 8px 12px;
            font-size: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease;
            white-space: nowrap;
        }
        
        .generate-btn:hover {
            background-color: #0056b3;
        }
        
        /* 반응형 디자인 */
        @media (max-width: 480px) {
            .signup-container {
                padding: 20px;
            }
            
            .tab-button {
                font-size: 14px;
                padding: 10px;
            }
            
            .form-group label {
                font-size: 13px;
            }
            
            .signup-button {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- 헤더 로딩 -->
    <div id="header-include"></div>
    
    <!-- 메인 컨텐츠 -->
    <div id="wrap">
        <div class="signup-container">
            <h2>회원가입</h2>
            
            <!-- 회원 유형 선택 탭 -->
            <div class="tab-container">
                <button class="tab-button active" id="tab-user" onclick="switchTab('user')" type="button">일반회원 회원가입</button>
                <button class="tab-button" id="tab-politician" onclick="switchTab('politician')" type="button">정치인 가입신청</button>
            </div>
            
            <!-- 회원가입 폼 -->
            <form id="signupForm" novalidate>
                <!-- 이메일 입력 -->
                <div class="form-group">
                    <label for="email" id="emailLabel">이메일</label>
                    <div class="input-with-button">
                        <input type="email" id="email" name="email" autocomplete="email" placeholder="이메일을 입력하세요" />
                        <button type="button" class="check-btn" id="emailAuthBtn">인증코드 받기</button>
                    </div>
                    <div class="help-text">※ 이메일은 공개되지 않으며, 암호화되어 안전하게 보관됩니다.</div>
                    <input type="text" id="emailCode" name="emailCode" autocomplete="one-time-code" placeholder="인증번호를 입력하세요" style="margin-top: 8px; display: none;" />
                    <div class="error-msg" id="emailError">올바른 이메일을 입력해 주세요.</div>
                    <div class="info-msg" id="emailAuthMsg"></div>
                </div>

                <!-- 비밀번호 입력 -->
                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="password" name="password" autocomplete="new-password" placeholder="9자리 이상, 영문/숫자/특수문자 조합" />
                    <div class="strength-msg" id="pwStrength"></div>
                    <div class="error-msg" id="pwError">비밀번호를 입력해 주세요.</div>
                </div>
                
                <!-- 비밀번호 확인 -->
                <div class="form-group">
                    <label for="confirm">비밀번호 확인</label>
                    <input type="password" id="confirm" name="confirm" autocomplete="new-password" placeholder="비밀번호를 다시 입력하세요" />
                    <div class="error-msg" id="confirmError">비밀번호가 일치하지 않습니다.</div>
                </div>
                
                <!-- 닉네임 입력 (일반회원용) -->
                <div class="form-group" id="nickname-field">
                    <label for="nickname">닉네임</label>
                    <div class="input-with-button">
                        <input type="text" id="nickname" name="nickname" autocomplete="nickname" placeholder="닉네임을 입력하세요" />
                        <button type="button" class="generate-btn" id="generateNicknameBtn">자동생성</button>
                        <button type="button" class="check-btn" id="checkNicknameBtn">중복 확인</button>
                    </div>
                    <div class="help-text">※ 닉네임은 공개되며, 하루 1회, 한 달 최대 3회까지 변경할 수 있습니다.</div>
                    <div class="error-msg" id="nicknameError">닉네임을 입력해 주세요.</div>
                    <div class="info-msg" id="nicknameCheckMsg"></div>
                </div>
                
                <!-- 정치인 추가 필드 -->
                <div id="politician-fields" style="display: none;">
                   
                    
                    <!-- 정치인 여부 선택 -->
                    <div class="form-group">
                        <label for="politicianRole">정치인 여부 선택</label>
                        <select class="select-box" id="politicianRole" name="politicianRole" onchange="handleRoleChange()">
                            <option value="">선택하세요</option>
                            <option value="self">정치인 본인</option>
                            <option value="staff">보좌진</option>
                        </select>
                    </div>
                    
                    <!-- 정치인 알림 동의 섹션 -->
                    <div class="agreement-section" id="politicianNotificationSection" style="display: none;">
                        <!-- 정치인 본인 알림 동의 -->
                        <div class="agreement-label" id="politicianNotificationAgreement" style="display: none;">
                            <input type="checkbox" id="politicianNotification" name="politicianNotification" /> 
                            정치방망이 게시판에 본인이 지목된 글 등록 시 이메일 알림받기 (선택)
                        </div>
                        
                        <!-- 보좌진 알림 동의 -->
                        <div class="agreement-label" id="staffNotificationAgreement" style="display: none;">
                            <input type="checkbox" id="staffNotification" name="staffNotification" /> 
                            정치방망이 게시판에 보좌하는 정치인이 지목된 글 등록 시 이메일 알림받기 (선택)
                        </div>
                    </div>
                    
                    <!-- 정치인 이름 (정치인 본인인 경우) -->
                    <div class="form-group" id="politicianNameField" style="display:none;">
                        <label for="politicianName">닉네임 (정치인 이름과 직책)</label>
                        <div class="input-with-button">
                            <input type="text" id="politicianName" name="politicianName" autocomplete="name" placeholder="이름과 직책을 입력하세요" />
                            <button type="button" class="check-btn" id="checkPoliticianNameBtn">중복 확인</button>
                        </div>
                        <div class="help-text">※ 닉네임 (정치인 이름과 직책)은 공개되며, 하루 1회, 한 달 최대 3회까지 변경할 수 있습니다.</div>
                        <div class="info-msg" id="politicianNameCheckMsg"></div>
                    </div>
                    
                    <!-- 보좌진 닉네임 (보좌진인 경우) -->
                    <div class="form-group" id="staffNicknameField" style="display:none;">
                        <label for="staffNickname">보좌진 닉네임</label>
                        <div class="input-with-button">
                            <input type="text" id="staffNickname" name="staffNickname" autocomplete="nickname" placeholder="보좌진 닉네임을 입력하세요" />
                            <button type="button" class="check-btn" id="checkStaffNicknameBtn">중복 확인</button>
                        </div>
                        <div class="help-text">※ 보좌진 닉네임은 공개되며, 하루 1회, 한 달 최대 3회까지 변경할 수 있습니다.</div>
                        <div class="info-msg" id="staffNicknameCheckMsg"></div>
                    </div>
                    
                    <!-- 정당 또는 소속 -->
                    <div class="form-group" id="partyField" style="display:none;">
                        <label for="party">정당 또는 소속</label>
                        <input type="text" id="party" name="party" autocomplete="organization" placeholder="정당 또는 소속을 입력하세요" />
                    </div>
                    
                    <!-- 보좌하는 정치인 (정치인 이름과 직책) (보좌진인 경우) -->
                    <div class="form-group" id="supportedPoliticianField" style="display:none;">
                        <label for="supportedPolitician">보좌하는 정치인 (정치인 이름과 직책)</label>
                        <input type="text" id="supportedPolitician" name="supportedPolitician" autocomplete="name" placeholder="보좌하는 정치인 (정치인 이름과 직책)을 입력하세요" />
                    </div>
                </div>
                
                <!-- 약관 동의 -->
                <div class="agreement-section">
                    <div class="agreement-label">
                        <input type="checkbox" id="terms" name="terms" /> 
                        이용약관에 동의합니다 (필수)
                    </div>
                    
                    <div class="agreement-label">
                        <input type="checkbox" id="privacy" name="privacy" /> 
                        개인정보 수집 및 이용에 동의합니다 (필수)
                    </div>
                    
                    <div class="error-msg" id="termsError">필수 항목에 동의해 주세요.</div>
                </div>
                
                <!-- 가입 버튼 -->
                <button type="submit" class="signup-button" id="signupBtn">
                    <span id="userSignupText">일반회원 회원가입</span>
                    <span id="politicianSignupText" style="display: none;">정치인 가입신청</span>
                </button>
            </form>
            
            <!-- 성공 메시지 -->
            <div class="success-msg" id="successMessage">
                회원가입이 완료되었습니다!
            </div>
        </div>
    </div>
    
    <!-- 푸터 로딩 -->
    <div id="footer-include"></div>
    
    <!-- JavaScript -->
    <script>
        // HTML 인클루드 함수
        function includeHTML(id, file) {
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    document.getElementById(id).innerHTML = data;
                })
                .catch(error => {
                    console.error('Include error:', error);
                });
        }
        
        // 헤더와 푸터 로드
        includeHTML("header-include", "header.html");
        includeHTML("footer-include", "footer.html");
        
        // DOM 요소 캐싱
        const form = document.getElementById('signupForm');
        const email = document.getElementById('email');
        const password = document.getElementById('password');
        const confirm = document.getElementById('confirm');
        const nickname = document.getElementById('nickname');
        const emailAuthBtn = document.getElementById('emailAuthBtn');
        const emailCode = document.getElementById('emailCode');
        const signupBtn = document.getElementById('signupBtn');
        
        const terms = document.getElementById('terms');
        const privacy = document.getElementById('privacy');
        const marketing = document.getElementById('marketing');
        
        const emailError = document.getElementById('emailError');
        const pwError = document.getElementById('pwError');
        const confirmError = document.getElementById('confirmError');
        const nicknameError = document.getElementById('nicknameError');
        const termsError = document.getElementById('termsError');
        const pwStrength = document.getElementById('pwStrength');
        const emailAuthMsg = document.getElementById('emailAuthMsg');
        const nicknameCheckMsg = document.getElementById('nicknameCheckMsg');
        const successMessage = document.getElementById('successMessage');
        
        // 인증 상태
        let isEmailVerified = false;
        let isNicknameChecked = false;
        let isNicknameAvailable = false;
        let isPoliticianNameChecked = false;
        let isStaffNicknameChecked = false;
        
        // 현재 탭 상태
        let currentTab = 'user';
        
        // 닉네임 자동 생성
        document.getElementById('generateNicknameBtn').addEventListener('click', () => {
            const adjectives = ['멋진', '똑똑한', '용감한', '친절한', '재미있는', '활발한', '성실한', '창의적인'];
            const nouns = ['호랑이', '독수리', '사자', '곰', '늑대', '여우', '토끼', '다람쥐'];
            const numbers = Math.floor(Math.random() * 1000);
            
            const randomAdjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];
            const generatedNickname = `${randomAdjective}${randomNoun}${numbers}`;
            
            nickname.value = generatedNickname;
            isNicknameChecked = false;
            nicknameCheckMsg.style.display = 'none';
        });
        
        // 이메일 인증
        emailAuthBtn.addEventListener('click', async () => {
            const emailValue = email.value.trim();
            
            if (!emailValue) {
                showMessage(emailAuthMsg, "이메일을 입력해주세요.", "red");
                return;
            }
            
            if (!validateEmail(emailValue)) {
                showMessage(emailAuthMsg, "올바른 이메일 형식이 아닙니다.", "red");
                return;
            }
            
            try {
                emailAuthBtn.disabled = true;
                showMessage(emailAuthMsg, "인증번호 전송 중...", "gray");
                
                await simulateApiCall('/api/send-email-auth', { email: emailValue });
                
                emailCode.style.display = 'block';
                showMessage(emailAuthMsg, "인증번호가 전송되었습니다.", "green");
                
                setTimeout(() => {
                    isEmailVerified = true;
                    showMessage(emailAuthMsg, "이메일 인증이 완료되었습니다.", "green");
                }, 2000);
            } catch (error) {
                showMessage(emailAuthMsg, "인증번호 전송에 실패했습니다.", "red");
            } finally {
                emailAuthBtn.disabled = false;
            }
        });
        
        // 닉네임 중복 확인
        document.getElementById('checkNicknameBtn').addEventListener('click', async () => {
            const nicknameValue = nickname.value.trim();
            
            if (!nicknameValue) {
                showMessage(nicknameCheckMsg, "닉네임을 입력해 주세요.", "red");
                return;
            }
            
            if (nicknameValue.length < 2 || nicknameValue.length > 20) {
                showMessage(nicknameCheckMsg, "닉네임은 2-20자 사이로 입력해주세요.", "red");
                return;
            }
            
            try {
                showMessage(nicknameCheckMsg, "확인 중...", "gray");
                
                const response = await simulateApiCall('/api/check-nickname', { nickname: nicknameValue });
                
                if (response.exists) {
                    showMessage(nicknameCheckMsg, "이미 사용 중인 닉네임입니다.", "red");
                    isNicknameAvailable = false;
                } else {
                    showMessage(nicknameCheckMsg, "사용 가능한 닉네임입니다.", "green");
                    isNicknameAvailable = true;
                }
                isNicknameChecked = true;
            } catch (error) {
                showMessage(nicknameCheckMsg, "서버 오류가 발생했습니다. 다시 시도해주세요.", "red");
                isNicknameAvailable = false;
            }
        });
        
        // 닉네임 입력 시 중복확인 초기화
        nickname.addEventListener('input', () => {
            isNicknameChecked = false;
            isNicknameAvailable = false;
            nicknameCheckMsg.style.display = 'none';
        });
        
        // 비밀번호 강도 체크
        function checkPasswordStrength(pw) {
            if (!pw) {
                pwStrength.textContent = '';
                pwStrength.style.display = 'none';
                return;
            }
            
            pwStrength.style.display = 'block';
            let strength = 0;
            
            if (pw.length >= 9) strength++;
            if (pw.length >= 12) strength++;
            if (/[A-Z]/.test(pw)) strength++;
            if (/[a-z]/.test(pw)) strength++;
            if (/[0-9]/.test(pw)) strength++;
            if (/[^A-Za-z0-9]/.test(pw)) strength++;
            
            if (strength <= 2) {
                pwStrength.textContent = '비밀번호 강도: 약함';
                pwStrength.className = 'strength-msg weak';
            } else if (strength <= 4) {
                pwStrength.textContent = '비밀번호 강도: 보통';
                pwStrength.className = 'strength-msg medium';
            } else {
                pwStrength.textContent = '비밀번호 강도: 강함';
                pwStrength.className = 'strength-msg strong';
            }
        }
        
        password.addEventListener('input', () => {
            checkPasswordStrength(password.value);
        });
        

        
        // 폼 제출 처리
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }
            
            try {
                signupBtn.disabled = true;
                signupBtn.textContent = '처리 중...';
                
                const formData = collectFormData();
                
                await simulateApiCall('/api/signup', formData);
                
                showSuccessMessage();
                
                setTimeout(() => {
                    form.reset();
                    resetFormStates();
                }, 2000);
                
            } catch (error) {
                alert('회원가입 중 오류가 발생했습니다. 다시 시도해주세요.');
            } finally {
                signupBtn.disabled = false;
                updateSignupButtonText();
            }
        });
        
        // 폼 유효성 검사
        function validateForm() {
            let isValid = true;
            
            hideAllErrors();
            clearErrorStyles();
            
            // 이메일 검사
            if (!email.value.trim()) {
                showError(email, emailError, "이메일을 입력해 주세요.");
                isValid = false;
            } else if (!validateEmail(email.value)) {
                showError(email, emailError, "올바른 이메일 형식이 아닙니다.");
                isValid = false;
            } else if (!isEmailVerified) {
                showError(email, emailError, "이메일 인증을 완료해주세요.");
                isValid = false;
            }
            
            // 비밀번호 검사
            const pwValue = password.value;
            if (!pwValue) {
                showError(password, pwError, "비밀번호를 입력해 주세요.");
                isValid = false;
            } else if (pwValue.length < 9) {
                showError(password, pwError, "비밀번호는 9자 이상이어야 합니다.");
                isValid = false;
            } else if (!/(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9])/.test(pwValue)) {
                showError(password, pwError, "비밀번호는 영문, 숫자, 특수문자를 포함해야 합니다.");
                isValid = false;
            }
            
            // 비밀번호 확인 검사
            if (!confirm.value) {
                showError(confirm, confirmError, "비밀번호 확인을 입력해 주세요.");
                isValid = false;
            } else if (password.value !== confirm.value) {
                showError(confirm, confirmError, "비밀번호가 일치하지 않습니다.");
                isValid = false;
            }
            
            // 일반회원 닉네임 검사
            if (currentTab === 'user') {
                if (!nickname.value.trim()) {
                    showError(nickname, nicknameError, "닉네임을 입력해 주세요.");
                    isValid = false;
                } else if (!isNicknameChecked || !isNicknameAvailable) {
                    showError(nickname, nicknameError, "닉네임 중복 확인을 해주세요.");
                    isValid = false;
                }
            }
            
            // 약관 동의 검사
            if (!terms.checked || !privacy.checked) {
                termsError.style.display = 'block';
                isValid = false;
            }
            
            // 정치인 탭인 경우 추가 검증
            if (currentTab === 'politician') {
                const role = document.getElementById('politicianRole').value;
                
                if (!role) {
                    alert('정치인 여부를 선택해주세요.');
                    isValid = false;
                }
                

                
                if (role === 'self') {
                    if (!document.getElementById('politicianName').value.trim()) {
                        alert('정치인 이름과 직책을 입력하세요');
                        isValid = false;
                    } else if (!isPoliticianNameChecked) {
                        alert('정치인 이름과 직책을 중복 확인을 해주세요.');
                        isValid = false;
                    }
                } else if (role === 'staff') {
                    if (!document.getElementById('staffNickname').value.trim()) {
                        alert('보좌진 닉네임을 입력해주세요.');
                        isValid = false;
                    } else if (!isStaffNicknameChecked) {
                        alert('보좌진 닉네임 중복 확인을 해주세요.');
                        isValid = false;
                    }
                    
                    if (!document.getElementById('supportedPolitician').value.trim()) {
                        alert('보좌하는 정치인 이름과 직책을 입력해주세요.');
                        isValid = false;
                    }
                }
                
                if (role && !document.getElementById('party').value.trim()) {
                    alert('정당 또는 소속을 입력해주세요.');
                    isValid = false;
                }
            }
            
            return isValid;
        }
        
        // 이메일 유효성 검사
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // 폼 데이터 수집
        function collectFormData() {
            const formData = {
                email: email.value.trim(),
                password: password.value,
                agreeTerms: terms.checked,
                agreePrivacy: privacy.checked,
                userType: currentTab
            };
            
            if (currentTab === 'user') {
                formData.nickname = nickname.value.trim();
            } else if (currentTab === 'politician') {
                formData.role = document.getElementById('politicianRole').value;
                formData.party = document.getElementById('party').value.trim();
                
                if (formData.role === 'self') {
                    formData.politicianName = document.getElementById('politicianName').value.trim();
                    formData.agreePoliticianNotification = document.getElementById('politicianNotification').checked;
                } else if (formData.role === 'staff') {
                    formData.staffNickname = document.getElementById('staffNickname').value.trim();
                    formData.supportedPolitician = document.getElementById('supportedPolitician').value.trim();
                    formData.agreeStaffNotification = document.getElementById('staffNotification').checked;
                }
            }
            
            return formData;
        }
        
        // 탭 전환
        function switchTab(type) {
            const politicianFields = document.getElementById("politician-fields");
            const nicknameField = document.getElementById("nickname-field");
            const userBtn = document.getElementById("tab-user");
            const politicianBtn = document.getElementById("tab-politician");
            const emailLabel = document.getElementById("emailLabel");
            
            currentTab = type;
            
            if (type === "politician") {
                politicianFields.style.display = "block";
                nicknameField.style.display = "none";
                politicianBtn.classList.add("active");
                userBtn.classList.remove("active");
                emailLabel.textContent = "국회·정부·지자체 발급 이메일";
            } else {
                politicianFields.style.display = "none";
                nicknameField.style.display = "block";
                userBtn.classList.add("active");
                politicianBtn.classList.remove("active");
                emailLabel.textContent = "이메일";
            }
            
            updateSignupButtonText();
            hideAllErrors();
            clearErrorStyles();
        }
        
        // 가입 버튼 텍스트 업데이트
        function updateSignupButtonText() {
            const userSignupText = document.getElementById("userSignupText");
            const politicianSignupText = document.getElementById("politicianSignupText");
            
            if (currentTab === 'politician') {
                userSignupText.style.display = 'none';
                politicianSignupText.style.display = 'inline';
            } else {
                userSignupText.style.display = 'inline';
                politicianSignupText.style.display = 'none';
            }
        }
        
        // 정치인 역할 변경 처리
        function handleRoleChange() {
            const role = document.getElementById("politicianRole").value;
            const politicianNameField = document.getElementById("politicianNameField");
            const staffNicknameField = document.getElementById("staffNicknameField");
            const partyField = document.getElementById("partyField");
            const supportedPoliticianField = document.getElementById("supportedPoliticianField");
            const politicianNotificationSection = document.getElementById("politicianNotificationSection");
            const politicianNotificationAgreement = document.getElementById("politicianNotificationAgreement");
            const staffNotificationAgreement = document.getElementById("staffNotificationAgreement");
            
            // 모든 필드 숨기기
            politicianNameField.style.display = "none";
            staffNicknameField.style.display = "none";
            partyField.style.display = "none";
            supportedPoliticianField.style.display = "none";
            politicianNotificationSection.style.display = "none";
            politicianNotificationAgreement.style.display = "none";
            staffNotificationAgreement.style.display = "none";
            
            if (role === "self") {
                politicianNameField.style.display = "block";
                partyField.style.display = "block";
                politicianNotificationSection.style.display = "block";
                politicianNotificationAgreement.style.display = "block";
            } else if (role === "staff") {
                staffNicknameField.style.display = "block";
                partyField.style.display = "block";
                supportedPoliticianField.style.display = "block";
                politicianNotificationSection.style.display = "block";
                staffNotificationAgreement.style.display = "block";
            }
        }
        
        // 정치인 이름 중복 확인
        document.getElementById('checkPoliticianNameBtn').addEventListener('click', async () => {
            const politicianName = document.getElementById('politicianName').value.trim();
            
            if (!politicianName) {
                showMessage(document.getElementById('politicianNameCheckMsg'), "정치인 이름과 직책을 입력해 주세요.", "red");
                return;
            }
            
            try {
                showMessage(document.getElementById('politicianNameCheckMsg'), "확인 중...", "gray");
                
                const response = await simulateApiCall('/api/check-politician-name', { name: politicianName });
                
                if (response.exists) {
                    showMessage(document.getElementById('politicianNameCheckMsg'), "이미 등록된 정치인 이름과 직책입니다.", "red");
                    isPoliticianNameChecked = false;
                } else {
                    showMessage(document.getElementById('politicianNameCheckMsg'), "사용 가능한 이름입니다.", "green");
                    isPoliticianNameChecked = true;
                }
            } catch (error) {
                showMessage(document.getElementById('politicianNameCheckMsg'), "서버 오류가 발생했습니다.", "red");
                isPoliticianNameChecked = false;
            }
        });
        
        // 보좌진 닉네임 중복 확인
        document.getElementById('checkStaffNicknameBtn').addEventListener('click', async () => {
            const staffNickname = document.getElementById('staffNickname').value.trim();
            
            if (!staffNickname) {
                showMessage(document.getElementById('staffNicknameCheckMsg'), "보좌진 닉네임을 입력해 주세요.", "red");
                return;
            }
            
            try {
                showMessage(document.getElementById('staffNicknameCheckMsg'), "확인 중...", "gray");
                
                const response = await simulateApiCall('/api/check-staff-nickname', { nickname: staffNickname });
                
                if (response.exists) {
                    showMessage(document.getElementById('staffNicknameCheckMsg'), "이미 사용 중인 닉네임입니다.", "red");
                    isStaffNicknameChecked = false;
                } else {
                    showMessage(document.getElementById('staffNicknameCheckMsg'), "사용 가능한 닉네임입니다.", "green");
                    isStaffNicknameChecked = true;
                }
            } catch (error) {
                showMessage(document.getElementById('staffNicknameCheckMsg'), "서버 오류가 발생했습니다.", "red");
                isStaffNicknameChecked = false;
            }
        });
        
        // 입력 변경 시 중복확인 초기화
        document.getElementById('politicianName').addEventListener('input', () => {
            isPoliticianNameChecked = false;
            document.getElementById('politicianNameCheckMsg').style.display = 'none';
        });
        
        document.getElementById('staffNickname').addEventListener('input', () => {
            isStaffNicknameChecked = false;
            document.getElementById('staffNicknameCheckMsg').style.display = 'none';
        });
        
        // 유틸리티 함수들
        function showError(input, errorElement, message) {
            input.classList.add('error');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        function showMessage(element, message, color) {
            element.textContent = message;
            element.style.color = color;
            element.style.display = 'block';
        }
        
        function hideAllErrors() {
            const errorMessages = document.querySelectorAll('.error-msg');
            errorMessages.forEach(msg => msg.style.display = 'none');
        }
        
        function clearErrorStyles() {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => input.classList.remove('error'));
        }
        
        function showSuccessMessage() {
            successMessage.style.display = 'block';
            successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        function resetFormStates() {
            isEmailVerified = false;
            isNicknameChecked = false;
            isNicknameAvailable = false;
            isPoliticianNameChecked = false;
            isStaffNicknameChecked = false;
            
            pwStrength.textContent = '';
            pwStrength.style.display = 'none';
            emailAuthMsg.style.display = 'none';
            nicknameCheckMsg.style.display = 'none';
            
            emailCode.style.display = 'none';
        }
        
        // API 호출 시뮬레이션
        function simulateApiCall(endpoint, data) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (endpoint === '/api/check-nickname' || endpoint === '/api/check-staff-nickname') {
                        resolve({ exists: data.nickname === 'admin' || data.nickname === 'test' });
                    } else if (endpoint === '/api/check-politician-name') {
                        resolve({ exists: data.name === '홍길동' });
                    } else {
                        resolve({ success: true });
                    }
                }, 1000);
            });
        }
        
        // 초기 설정
        updateSignupButtonText();
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const tab = params.get('tab');
            if (tab === 'politician') {
                switchTab('politician');
            }
        });
    </script>
</body>
</html>